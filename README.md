# Мини-CRM система распределения лидов
--
## Описание
Система для автоматического распределения обращений лидов между операторами с учетом:
- Весов операторов по источникам
- Лимитов нагрузки операторов
- Процентного распределения трафика

## Установка
1. Склонировать репозиторий
```bash
git clone https://github.com/DianaShakirovaM/crm
```
2. Создать виртуальное окружение
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate     # Windows
```
3. Запустить сервер
```bash
uvicorn app.main:app --reload
```

## Модель данных
1. Lead (Лид) — потенциальный клиент
- external_id — уникальный ID из внешней системы
- email, phone — контактные данные
Может иметь много обращений
2. Contact (Обращение) — отдельный контакт от лида
- lead_id — ссылка на лида
- source_id — источник обращения
- operator_id — назначенный оператор
- is_active — активно ли обращение
3. Operator (Оператор) — сотрудник
- name — имя
- is_active — доступен ли
- max_load — максимальная нагрузка
4. Source (Источник) — канал поступления
- name — название источника
- Веса для операторов

## Как определяется, что обращения принадлежат одному лиду?
По полю external_id. Если у двух обращений одинаковый external_id — они от одного лида.

## Как учитываются веса операторов по источникам?
Для каждого источника у оператора есть вес (1-100). Больше вес → больше шансов получить обращение. Приоритет = вес × доступная_емкость.

## Как учитываются лимиты нагрузки?
У каждого оператора есть max_load (максимум активных обращений). Если текущая_нагрузка >= max_load — оператор не получает новые обращения. Доступная емкость = max_load - текущая_нагрузка.

## Что происходит, если подходящих операторов нет?
Обращение создается без оператора (operator_id = NULL). Остается в статусе "новое". Можно назначить вручную или система назначит при появлении свободных операторов

## Как работает распределение
- Определяется источник обращения
- Находятся все активные операторы с весами для этого источника
- Исключаются перегруженные операторы (превышен лимит)
- Вычисляется приоритет для каждого: вес × доступная_емкость
- Выбирается случайный оператор с учетом приоритетов


